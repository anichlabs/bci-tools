# Use official slim Python 3.10 image (Debian-based)
FROM python:3.10-slim

# Set basic environment variables for predictable builds
ENV DEBIAN_FRONTEND=noninteractive \
    PYTHONUNBUFFERED=1 \
    TZ=UTC

# Install essential system tools and dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential \
    git \
    curl \
    wget \
    ca-certificates \
    tzdata \
    locales \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# Install Miniconda (lightweight Anaconda) for Python environment management
ENV CONDA_DIR=/opt/conda
RUN wget --quiet https://repo.anaconda.com/miniconda/Miniconda3-py310_24.3.0-0-Linux-x86_64.sh -O /tmp/miniconda.sh && \
    mkdir -p $CONDA_DIR && \
    bash /tmp/miniconda.sh -b -u -p $CONDA_DIR && \
    rm /tmp/miniconda.sh

# Add Conda to PATH
ENV PATH=$CONDA_DIR/bin:$PATH

# Install Mamba (fast Conda) and JupyterLab
RUN conda install -y -n base -c conda-forge mamba && \
    mamba install -y -n base -c conda-forge \
        jupyterlab \
        scikit-learn \
        nodejs \
        pyxdf pyserial \
        numpy pandas scipy matplotlib \
        pytorch mne seaborn ipywidgets \
        nbconvert \
        pip && \
    pip install brainflow && \
    mamba clean --all -y

# Set default working directory
WORKDIR /lab

# Expose 8888
EXPOSE 8888

# Start JupyterLab on container run           
CMD ["jupyter", "lab", "--ip=0.0.0.0", "--port=8888", "--no-browser", "--NotebookApp.token=''", "--NotebookApp.password=''"] 





